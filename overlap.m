clc
clear variables
close all

%% Determening paths and setting folders
currdir = pwd;
addpath(pwd);
filedir = uigetdir();
cd(filedir);

Ecad = readtable('Ecad.csv');
HP1 = readtable('HP1.csv');
STAT = readtable('STAT.csv');

Ecad = Ecad(Ecad.Ecad_p_adjusted < 0.05,:);
HP1 = HP1(HP1.HP1_p_adjusted < 0.05,:);
STAT = STAT(STAT.STAT_p_adjusted < 0.05,:);

Overlap = innerjoin(Ecad, HP1, 'Keys', 'gene');
OverlapES = innerjoin(Ecad, STAT, 'Keys', 'gene');
OverlapHS = innerjoin(HP1, STAT, 'Keys', 'gene');
OverlapSTAT = innerjoin(Overlap, STAT, 'Keys', 'gene');

Overlap_pos = Overlap(Overlap.Ecad_statistic > 0 & Overlap.HP1_statistic > 0,:);
Overlap_neg = Overlap(Overlap.Ecad_statistic < 0 & Overlap.HP1_statistic < 0,:);
Overlap_posneg = Overlap((Overlap.Ecad_statistic > 0 & Overlap.HP1_statistic < 0) | (Overlap.Ecad_statistic < 0 & Overlap.HP1_statistic > 0),:);

Pos_genes = string([Overlap_pos.gene, Overlap_pos.Name_Ecad]);
PG2 = array2table(cellstr(Pos_genes));
PG2.Properties.VariableNames = {'gene','name'};
writetable(PG2, 'Positive_genes.csv');

Neg_genes = string([Overlap_neg.gene, Overlap_neg.Name_Ecad]);
NG2 = array2table(cellstr(Neg_genes));
NG2.Properties.VariableNames = {'gene','name'};
writetable(NG2, 'Negative_genes.csv');

cancer = readtable('cancer.txt');

Overlap_C = innerjoin(NG2, cancer, 'Keys', 'gene');
Overlap_C2 = innerjoin(PG2, cancer, 'Keys', 'gene');

embryo = ' FBgn0004419 FBgn0051720 FBgn0030766 FBgn0261791 FBgn0001105 FBgn0065035 FBgn0002914 FBgn0038737 FBgn0261984 FBgn0030269 FBgn0030268 FBgn0032198 FBgn0032197 FBgn0024807 FBgn0032956 FBgn0030686 FBgn0030685 FBgn0031815 FBgn0031814 FBgn0001941 FBgn0039637 FBgn0005596 FBgn0266599 FBgn0045035 FBgn0033663 FBgn0003942 FBgn0025366 FBgn0051718 FBgn0067622 FBgn0032240 FBgn0016698 FBgn0031529 FBgn0031528 FBgn0030706 FBgn0010315 FBgn0261108 FBgn0030718 FBgn0039402 FBgn0266668 FBgn0053180 FBgn0040687 FBgn0027866 FBgn0030704 FBgn0030703 FBgn0032974 FBgn0000257 FBgn0026430 FBgn0024432 FBgn0010877 FBgn0285952 FBgn0034966 FBgn0034965 FBgn0034110 FBgn0034109 FBgn0261802 FBgn0025674 FBgn0086134 FBgn0038047 FBgn0038046 FBgn0030013 FBgn0265464 FBgn0283500 FBgn0035194 FBgn0052318 FBgn0264294 FBgn0033188 FBgn0030717 FBgn0030716 FBgn0032705 FBgn0025608 FBgn0033624 FBgn0037746 FBgn0266720 FBgn0021796 FBgn0265262 FBgn0040682 FBgn0037298 FBgn0030274 FBgn0020255 FBgn0026417 FBgn0260794 FBgn0024909 FBgn0037530 FBgn0032196 FBgn0004587 FBgn0004237 FBgn0039450 FBgn0039449 FBgn0033762 FBgn0033761 FBgn0032919 FBgn0023388 FBgn0038299 FBgn0261602 FBgn0010909 FBgn0033486 FBgn0031608 FBgn0285948 FBgn0030314 FBgn0030313 FBgn0027259 FBgn0002873 FBgn0031050 FBgn0030573 FBgn0030572 FBgn0283535 FBgn0014366 FBgn0038857 FBgn0003964 FBgn0000667 FBgn0030943 FBgn0027335 FBgn0015025 FBgn0261722 FBgn0264959 FBgn0002774 FBgn0033929 FBgn0029506 FBgn0029507 FBgn0022981 FBgn0040466 FBgn0036334 FBgn0036333 FBgn0038300 FBgn0260755 FBgn0035162 FBgn0002780 FBgn0040206 FBgn0022787 FBgn0002783 FBgn0029833 FBgn0003302 FBgn0030745 FBgn0030744 FBgn0001215 FBgn0026400 FBgn0037244 FBgn0015019 FBgn0038454 FBgn0267821 FBgn0260938 FBgn0263005 FBgn0004837 FBgn0001977 FBgn0004367 FBgn0010416 FBgn0016983 FBgn0052380 FBgn0051550 FBgn0015402 FBgn0033378 FBgn0033377 FBgn0283666 FBgn0023170 FBgn0032229 FBgn0032228 FBgn0015754 FBgn0034085 FBgn0266111 FBgn0033717 FBgn0034002 FBgn0034001 FBgn0039831 FBgn0039830 FBgn0041604 FBgn0027375 FBgn0030699 FBgn0027093 FBgn0035285 FBgn0042712 FBgn0052176 FBgn0052174 FBgn0042641 FBgn0032703 FBgn0032702 FBgn0031738 FBgn0004106 FBgn0034577 FBgn0003391 FBgn0039560 FBgn0039559 FBgn0262127 FBgn0035236 FBgn0035235 FBgn0030671 FBgn0030670 FBgn0035623 FBgn0035622 FBgn0031023 FBgn0027621 FBgn0040890 FBgn0031022 FBgn0032961 FBgn0086779 FBgn0030969 FBgn0030968 FBgn0053052 FBgn0003559 FBgn0039944 FBgn0026441 FBgn0264832 FBgn0038316 FBgn0250843 FBgn0024320 FBgn0039600 FBgn0005642 FBgn0010078 FBgn0034786 FBgn0027872 FBgn0035283 FBgn0030347 FBgn0030346 FBgn0032236 FBgn0036405 FBgn0283503 FBgn0032295 FBgn0032294 FBgn0027868 FBgn0031910 FBgn0003464 FBgn0015527 FBgn0039175 FBgn0040233 FBgn0040232 FBgn0263773 FBgn0284235 FBgn0050011 FBgn0010531 FBgn0032261 FBgn0086347 FBgn0032698 FBgn0005617 FBgn0030710 FBgn0045073 FBgn0032394 FBgn0016970 FBgn0028473 FBgn0032217 FBgn0032216 FBgn0028683 FBgn0053792 FBgn0033757 FBgn0261004 FBgn0037110 FBgn0037109 FBgn0039335 FBgn0004509 FBgn0260749 FBgn0283442 FBgn0283440 FBgn0010422 FBgn0037093 FBgn0026371 FBgn0027081 FBgn0029137 FBgn0001986 FBgn0001989 FBgn0035471 FBgn0003943 FBgn0013756 FBgn0032690 FBgn0051789 FBgn0032689 FBgn0261986 FBgn0027508 FBgn0036536 FBgn0033871 FBgn0000662 FBgn0031909 FBgn0003416 FBgn0267791 FBgn0034523 FBgn0262736 FBgn0283658 FBgn0050291 FBgn0023000 FBgn0260634 FBgn0053111 FBgn0015513 FBgn0039120';
embryo2 = split(embryo);

EG2 = array2table(cellstr(embryo2));
EG2.Properties.VariableNames = {'gene'};
writetable(NG2, 'Embryo_genes.csv');

larvae = ' FBgn0015331 FBgn0037220 FBgn0032246 FBgn0005683 FBgn0262679 FBgn0034853 FBgn0003977 FBgn0028480 FBgn0052679 FBgn0028331 FBgn0000459 FBgn0029755 FBgn0029754 FBgn0030088 FBgn0004856 FBgn0034704 FBgn0034703 FBgn0024250 FBgn0038300 FBgn0029155 FBgn0039492 FBgn0036518 FBgn0036516 FBgn0034723 FBgn0003870 FBgn0028984 FBgn0022724 FBgn0030894 FBgn0028387 FBgn0039419 FBgn0266486 FBgn0033391 FBgn0030631 FBgn0030630 FBgn0031057 FBgn0031119 FBgn0031118 FBgn0011760 FBgn0022768 FBgn0029785 FBgn0015794 FBgn0250869 FBgn0027590 FBgn0032202 FBgn0011305 FBgn0015801 FBgn0030360 FBgn0032231 FBgn0032243 FBgn0032242 FBgn0261053 FBgn0250906 FBgn0261524 FBgn0010303 FBgn0035529 FBgn0035528 FBgn0034975 FBgn0023081 FBgn0004892 FBgn0031910 FBgn0028499 FBgn0029594 FBgn0026088 FBgn0034971 FBgn0034970 FBgn0031390 FBgn0259733 FBgn0259731 FBgn0259732 FBgn0259730 FBgn0263316 FBgn0030484 FBgn0051211 FBgn0037963 FBgn0030528 FBgn0034049 FBgn0042094 FBgn0034542 FBgn0041111 FBgn0024947 FBgn0036510 FBgn0036509 FBgn0024555 FBgn0262353 FBgn0025624 FBgn0025629 FBgn0243516 FBgn0261239 FBgn0051626 FBgn0000711 FBgn0030196 FBgn0034032 FBgn0262937 FBgn0085408 FBgn0015602 FBgn0020767 FBgn0030813 FBgn0030812 FBgn0010638 FBgn0026427 FBgn0037849 FBgn0011768 FBgn0011604 FBgn0061360 FBgn0061359 FBgn0033060 FBgn0284246 FBgn0039229 FBgn0027617 FBgn0012058 FBgn0030091 FBgn0085390 FBgn0004364 FBgn0010105 FBgn0036686 FBgn0036685 FBgn0265003 FBgn0022224 FBgn0033104 FBgn0033153 FBgn0051739 FBgn0051495 FBgn0021765 FBgn0030892 FBgn0034087 FBgn0034086 FBgn0261244 FBgn0038609 FBgn0038608 FBgn0024179 FBgn0261560 FBgn0033382 FBgn0027561 FBgn0029131 FBgn0033961 FBgn0033960 FBgn0031638 FBgn0031637 FBgn0013718 FBgn0036414 FBgn0261836 FBgn0031684 FBgn0261617 FBgn0031897 FBgn0050349 FBgn0284436 FBgn0035726 FBgn0035725 FBgn0053096 FBgn0053095 FBgn0022213 FBgn0003218 FBgn0005771 FBgn0036928 FBgn0036927 FBgn0038043 FBgn0038042 FBgn0036666 FBgn0023216 FBgn0264495 FBgn0037443 FBgn0053229 FBgn0035113 FBgn0010768 FBgn0266083 FBgn0031054 FBgn0031053 FBgn0250848 FBgn0036391 FBgn0023545 FBgn0003360 FBgn0025111 FBgn0003345 FBgn0029825 FBgn0010411 FBgn0005655 FBgn0033485 FBgn0261445';
larvae2 = split(larvae);

LG2 = array2table(cellstr(larvae2));
LG2.Properties.VariableNames = {'gene'};
writetable(NG2, 'Larval_genes.csv');

Peaks = [embryo2;larvae2];
Peaks2 = array2table(cellstr(Peaks));
Peaks2.Properties.VariableNames = {'gene'};

Overlap_Peaks = innerjoin(HP1, Peaks2, 'Keys', 'gene');
Overlap_PeaksPos = innerjoin(HP1(HP1.HP1_statistic > 0,:), Peaks2, 'Keys', 'gene');
Overlap_PeaksNeg = innerjoin(HP1(HP1.HP1_statistic < 0,:), Peaks2, 'Keys', 'gene');
